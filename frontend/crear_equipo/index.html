<!DOCTYPE html>
<html lang="en">
<head>
    <title>Dream Team</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <img src="../Encabezado_DreamTeam.png" alt="Logo Dream team">
        <a href="#" target="_blank">Â¿Que es DREAM TEAM?</a>
    </header>
    <main>
        <div class="estadio">
            <div class="grada">
                <div class="campo">
                    <div class="contenedor-porteria">
                        <div class="porteria porteria-izquierda"></div>
                    </div>
                    <div class="izquierda">
                        <div class="corner corner-superior"></div>
                        <div class="area">
                            <div class="area-pequena"></div>
                            <div class="punto-penalty"></div>
                            <div class="arco"></div>
                        </div>
                        <div class="arquero"></div>
                        <div class="defensores">
                            <div class="defensor"></div>
                            <div class="defensor"></div>
                        </div>
                        <div class="corner corner-inferior"></div>
                    </div>
                    <div class="derecha">
                        <div class="corner corner-superior"></div>
                        <div class="area">
                            <div class="area-pequena"></div>
                            <div class="punto-penalty"></div>
                            <div class="arco"></div>
                        </div>
                        <div class="mediocampista"></div>
                        <div class="delantero"></div>
                        <div class="corner corner-inferior"></div>
                    </div>
                    <div class="contenedor-porteria">
                        <div class="porteria porteria-derecha"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <form id="team-form" onsubmit="submitForm(event)">
            <label class="nombre_equipo">Nombre del Equipo:</label>
            <input type="text" name="nombre_equipo" required>
            <div>
                <label>Arquero:</label>
                <select name="arquero" required></select>
                
                <label>Defensor 1:</label>
                <select name="defensor1" required></select>
                
                <label>Defensor 2:</label>
                <select name="defensor2" required></select>
                
                <label>Mediocampista:</label>
                <select name="mediocampista" required></select>

                <label>Delantero:</label>
                <select name="delantero" required></select>
            </div>
            <button type="submit">Enviar</button>
        </form>
    </footer>
    <script>
        let jugadores = [];

        function response_received(response) {
            console.log('Response received:', response);
            return response.json();
        }

        function request_error(error) {
            console.error('Request failed:', error);
        }

        function fillForm(jugadores, position) {
            const select = document.querySelector(`select[name="${position}"]`);
            select.innerHTML = '';

            jugadores.forEach(jugador => {
                const option = document.createElement("option");
                option.value = jugador.id;
                option.textContent = jugador.nombre;
                select.append(option);
            });
        }

        function parse_data(jugadoresData) {
            jugadores = jugadoresData;
            console.log('Jugadores:', jugadores);
            fillForm(jugadores.filter(j => j.posicion === "arq"), "arquero");
            fillForm(jugadores.filter(j => j.posicion === "def"), "defensor1");
            fillForm(jugadores.filter(j => j.posicion === "def"), "defensor2");
            fillForm(jugadores.filter(j => j.posicion === "med"), "mediocampista");
            fillForm(jugadores.filter(j => j.posicion === "del"), "delantero");

            const arqueroImg = document.querySelector('.arquero');
            const defensores = document.querySelectorAll('.defensor');
            const mediocampistaImg = document.querySelector('.mediocampista');
            const delanteroImg = document.querySelector('.delantero');

            arqueroImg.innerHTML = `<img src="${jugadores.find(j => j.posicion === 'arq').imagen}" alt="Arquero" class="tarjeta_jugador">`;
            defensores.forEach((defensor, index) => {
                defensor.innerHTML = `<img src="${jugadores.filter(j => j.posicion === 'def')[index].imagen}" alt="Defensor" class="tarjeta_jugador">`;
            });
            mediocampistaImg.innerHTML = `<img src="${jugadores.find(j => j.posicion === 'med').imagen}" alt="Mediocampista" class="tarjeta_jugador">`;
            delanteroImg.innerHTML = `<img src="${jugadores.find(j => j.posicion === 'del').imagen}" alt="Delantero" class="tarjeta_jugador">`;
        }

        function submitForm(event) {
            event.preventDefault();
            const form = event.target;

            const arquero = jugadores.find(j => j.id == form.arquero.value);
            const defensa1 = jugadores.find(j => j.id == form.defensor1.value);
            const defensa2 = jugadores.find(j => j.id == form.defensor2.value);
            const medio = jugadores.find(j => j.id == form.mediocampista.value);
            const delantero = jugadores.find(j => j.id == form.delantero.value);

            const puntaje = (arquero.puntaje + defensa1.puntaje + defensa2.puntaje + medio.puntaje + delantero.puntaje) / 5;

            const equipo = {
                nombre_equipo: form.nombre_equipo.value,
                arquero_id: arquero.id,
                defensa1_id: defensa1.id,
                defensa2_id: defensa2.id,
                medio_id: medio.id,
                delantero_id: delantero.id,
                puntaje: puntaje
            };

            fetch("http://localhost:5000/guardar_equipo", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(equipo)
            })
            .then(response_received)
            .then(data => console.log(data))
            .catch(request_error);
        }

        fetch("http://localhost:5000/jugadores")
            .then(response_received)
            .then(parse_data)
            .catch(request_error);
    </script>
</body>
</html>
